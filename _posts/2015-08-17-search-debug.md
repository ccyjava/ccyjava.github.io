---
layout: post
title: 搜索引擎debug策略
description: 如何发现搜索引擎的潜在问题
category: blog
---
>本文的策略不仅可以用在搜索引擎中，也可以用在其他的流水线数据处理系统中。这些系统的特点是多个数据模块串行的处理数据，这样最终的结果如果效果不好很难分析问题所在。

##分清不同的阶段
搜索引擎是一个复杂的系统，其由不同的层次模块组成：最底层是索引构建模块，它包含页面理解，版权信息抽取等功能，在上面是 match模块，负责将匹配了query中所有word的文档返回，在往上是L1 Ranker，L2 Ranker 和L3Ranker，其中L1,L2 Ranker一般是在线的Ranker，L3 Ranker一般是离线的Ranker，之所以离线是因为其采用更加复杂的特征，导致特征提取和使用Ranker评分都比较慢，所以只能离线操作。在往上就是商务逻辑统筹调度模块，它负责分析不同的query去触发那些服务，例如用户输入一个"cat image",它就分析出来用户想查猫的图片，就会去请求图片搜索。在往上就是页面服务模块，负责接收用户请求和渲染页面。

这是搜索引擎返回结果的线，从上往下看还有一条线，分别是查询词纠错模块，查询理解模块，查询词增强模块等等。
另外每个模块可能构造的非常复杂，例如查询词理解模块可能会采用深度学习为每个查询词学习出复杂的标签，页面理解模块可能会用复杂的分类算法为每个页面分出精细的类别等等。
##构建每个阶段的GroudTruth
互联网上有几十亿个网页，如果想为每个查询词找到其最为精确的结果是非常难的。一般来说大家的通常做法是把个大搜索引擎对这个查询词的top N的结果爬取下来，然后找人标注，把那些认为是相关的结果当成GroudTruth。

由于搜索引擎是一个Pipline，所以更为精确的debug方法是分层来分析。例如match返回的结果应该包含所有的GroudTruth。L1 Ranker的GroudTruth应该是把match输出的结果按照人工标注的结果排序。L2的因该是L1的结果经过人工排序。这样以此类推，如果哪一个与GroundTruth差距拉大，就很容易定位出这一层出了问题。

##度量指标
一般来说一个信息检索系统的度量指标有很多种，例如DCG，NDCG，MAP，Precise，Coverage，F-Score等，最常用的一般是DCG和Coverage. NDCG是DCG正则化的结果，其计算较为复杂，而且不比DCG对训练结果更有意义。Precise很难度量。



##索引构建的详细分析


<pre class="prettyprint">

</pre>